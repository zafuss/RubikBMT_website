<!doctype html>
<html lang="en" class="light-style layout-menu-fixed layout-compact" dir="ltr"
      data-theme="theme-default" data-assets-path="/admin/assets/"
      data-template="vertical-menu-template-free" data-style="light">
<head th:replace="~{library/lib_admin.html::head('User Management')}">
    <style>
        /* B·∫°n c√≥ th·ªÉ th√™m c√°c style t√πy ch·ªânh ·ªü ƒë√¢y */
    </style>
</head>
<body>
<!-- Layout wrapper -->
<div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
        <!-- Menu -->
        <aside th:replace="~{library/lib_admin.html::sidebar}"></aside>
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
            <!-- Navbar -->
            <nav th:replace="~{library/lib_admin.html::navbar}"></nav>
            <!-- / Navbar -->

            <!-- Content wrapper -->
            <div class="content-wrapper">
                <!-- Content -->
                <div th:fragment="content">
                    <div class="container-xxl flex-grow-1 container-p-y">
                        <!--                        <a href="/classrooms/addClassroom" class="btn btn-primary mb-3">Th√™m l·ªõp h·ªçc</a>-->
                        <!-- Basic Bootstrap Table -->
                        <div class="card">
                            <h5 class="card-header">Danh s√°ch l·ªõp h·ªçc</h5>
                            <div class="p-6" id="calendar"></div>
                            <input type="hidden" id="classroomId" th:value="${classroomId}">
                        </div>
                    </div>
                    <!-- / Content -->
                </div>
                <!-- Content wrapper -->
            </div>
            <!-- / Layout page -->
        </div>

        <!-- Overlay -->
        <div class="layout-overlay layout-menu-toggle"></div>
    </div>
</div>
<!-- / Layout wrapper -->

<!-- Core JS -->
<script src="/admin/assets/vendor/libs/jquery/jquery.js"></script>
<script src="/admin/assets/vendor/libs/popper/popper.js"></script>
<script src="/admin/assets/vendor/js/bootstrap.js"></script>
<script src="/admin/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
<script src="/admin/assets/vendor/js/menu.js"></script>

<!-- Vendors JS -->
<script src="/admin/assets/vendor/libs/apex-charts/apexcharts.js"></script>
<!-- Main JS -->
<script src="/admin/assets/js/main.js"></script>
<!-- Page JS -->
<script src="/admin/assets/js/dashboards-analytics.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.js"></script>


<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function () {
        const classroomId = document.getElementById('classroomId').value;
        const calendarEl = document.getElementById('calendar');

        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'timeGridWeek',
            locale: 'vi',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'timeGridWeek,timeGridDay'
            },
            slotMinTime: '08:00:00',
            slotMaxTime: '21:00:00',
            events: async function (fetchInfo, successCallback, failureCallback) {
                try {
                    const response = await fetch(`/api/sessions/by-classroom?classroomId=${classroomId}`);
                    if (!response.ok) throw new Error('L·ªói khi t·∫£i d·ªØ li·ªáu!');
                    const data = await response.json();
                    successCallback(data);
                } catch (error) {
                    console.error('L·ªói t·∫£i l·ªãch:', error);
                    failureCallback(error);
                }
            },
            eventContent: function (info) {
                // L·∫•y th√¥ng tin t·ª´ extendedProps
                const { teacher, description, course } = info.event.extendedProps;

                // T·∫°o c√°c ph·∫ßn t·ª≠ HTML
                const titleEl = document.createElement('div');
                titleEl.textContent = info.event.title;
                titleEl.style.fontWeight = 'bold';

                const courseEl = document.createElement('div');
                courseEl.textContent = `Kho√° h·ªçc: ${course}`;

                const teacherEl = document.createElement('div');
                teacherEl.textContent = `Gi√°o vi√™n: ${teacher}`;

                const descriptionEl = document.createElement('div');
                descriptionEl.textContent = `üìù M√¥ t·∫£: ${description}`;

                // G·ªôp c√°c ph·∫ßn t·ª≠
                return { domNodes: [titleEl, courseEl, teacherEl] };
            },
            eventClick: function (info) {
                // Chuy·ªÉn h∆∞·ªõng khi click v√†o s·ª± ki·ªán
                window.location.href = info.event.url;
            }
        });

        calendar.render();
    });
</script>
</body>
</html>